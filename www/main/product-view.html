<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <header>
        <h2>OpenSale</h2>
    </header>
    <main>
        <div class="view-product-data">
            <h2 class="view-product-title"></h2>
            <h3 class="view-product-price"></h3>
        </div>
        <div class="view-product-images"></div>
        <div class="view-product-description"></div>
        <div class="view-product-manage-btns-list">
            <div class="view-product-manage-btn" id="selectCart"></div>
            <div class="view-product-manage-btn"></div>
        </div>
    </main>
    <footer>
        <div class="footer-page" onclick="history.back(); location.replace('index.html')">
            <i class="fas fa-home"></i>
            <div class="footer-page-title">Home</div>
        </div>
        <div class="footer-page" onclick="location.replace('cart.html')">
            <i class="fas fa-shopping-cart"></i>
            <div class="footer-page-title">Cart</div>
        </div>
        <div class="footer-page" onclick="location.replace('profile.html')">
            <i class="fas fa-user"></i>
            <div class="footer-page-title">Profile</div>
        </div>
    </footer>
    <br><br><br><br><br>

<script src="js/config.js"></script>
<script src="js/script.js"></script>
<script>
    var productTitle = document.querySelector(".view-product-title")
    var productPrice = document.querySelector(".view-product-price")
    var productImages = document.querySelector(".view-product-images")
    var productDescription = document.querySelector(".view-product-description")
    var selectCart = document.getElementById("selectCart")
    var accessToken = localStorage.getItem("accessToken")
    var product_id = sessionStorage.getItem("open_product_id")
    var fHeaders = null
    
    if (accessToken) {fHeaders = {method: "GET", headers: {"Content-Type": "application/json", "authorization": `Bearer ${accessToken}`}}}
    else {fHeaders = {method: "GET"}}
    
    if (product_id == null) {history.back(); location.replace("index.html")}
    
    fetch(baseUrl+"/products?product_id="+product_id, fHeaders)
    .then(res => res.json())
    .then(data => {
        console.log(data)
        productTitle.textContent = data.title
        productPrice.textContent = data.price
        data.images.forEach((image) => {
            var imageBox = document.createElement("img")
            imageBox.src = baseUrl+image.image
            productImages.appendChild(imageBox)
        })
        productDescription.textContent = data.description
        if (accessToken) {
            if (data.saved) {selectCart.textContent = "Remove from cart"}
            else {selectCart.textContent = "Add to Cart"}
            selectCart.onclick = () => cartFunc(data.id)
        }
    })
    .catch(err => customErrorAlert(err))
    
    var cartFunc = (product_id) => {
        fetch(baseUrl+"/user/saved_products/", {
            method: "POST",
            headers: {"Content-Type": "application/json", "authorization": `Bearer ${accessToken}`},
            body: JSON.stringify({product_id: product_id})
        })
        .then(res => res.json())
        .then(data => {
            if (data.detail) {customErrorAlert(data.detail)}
            console.log(data)
            if (data.status == true) {selectCart.textContent = "Add to Cart"}
            else {selectCart.textContent = "Remove from cart"}
        })
    }
</script>
</body>
</html>